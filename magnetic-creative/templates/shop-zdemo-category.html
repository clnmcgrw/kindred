<!--
    templateType: page
    isAvailableForNewContent: true
-->


{% include '/magnetic-creative/partials/header-primary.html' %}

{# all tables associated w/ shop #}
{% set ksProductsTableId = 2036891 %}
{% set ksParentCategoryTableId = 2036894 %}
{% set ksChildCategoryTableId = 2036892 %}

{# determine parent (1) or child (2) category #}
{% set ksSlugDepth = dynamic_page_route_level %}

{# row id for matching category #}
{% set ksCategoryRowId = dynamic_page_hubdb_row.hs_id %}

{# get table id for the matching category/row #}
{% set ksCategoryRowTableId = ksParentCategoryTableId if ksSlugDepth == 1 else ksChildCategoryTableId %}

{# get all row data for category #}
{% set ksCategoryRowData = hubdb_table_row(ksCategoryRowTableId, ksCategoryRowId) %}



{# parent category page ---------------------- #}
{% if ksSlugDepth == 1 %}
  {% set parentCategory = dynamic_page_hubdb_row %}
  {% set ksChildTableId = parentCategory.hs_child_table_id %}
  {% set ksChildTableFilterQuery = 'parent_category__contains=' + ksCategoryRowData.name %}
  {% set ksChildTableData = hubdb_table_rows(ksChildTableId, ksChildTableFilterQuery) %}

  <section class="ks-introtext ks-introtext--hero ">
    <div class="ks-inner">
      <div class="ks-introtext__content">
        <div class="ks-introtext__preheading">
          <span class="ks-preheading">Outdoors</span>
        </div>
        <div class="ks-introtext__main">
          <h1 class="ks-headline--md">{{parentCategory.listing_page_heading}}</h1>
          <div class="ks-rte-content">
            <p>{{parentCategory.listing_page_intro_body}}</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="ks-categorylist">
    <div class="ks-inner">
      <div class="ks-categorylist__bgimg" style="background-image: url('{{ ksCategoryRowData.image.url }}')"></div>

      <div class="ks-categorylist__main">
        <div class="ks-categorylist__images">
          {% for child in ksChildTableData %}
            <figure class="ks-figure">
              <div class="ks-figure__liner" style="padding-bottom: {{ (child.thumbnail_image.height / child.thumbnail_image.width) * 100 }}%">
                <img src="{{ child.thumbnail_image.url }}" alt="{{ child.thumbnail_image.alt }}">
              </div>
            </figure>
          {% endfor %}
        </div>
        <div class="ks-categorylist__titles">
          <ul>
            {% for child in ksChildTableData %}
              <li class="ks-headline ks-headline--md">
                <a href="/shop/{{ ksCategoryRowData.hs_path }}/{{ child.hs_path }}">{{ child.hs_name }}</a>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </section>

  {# <section class="ks-section" style="background:#fff;padding:5rem 0;margin-top:5rem;">
    <h1>Parent Category: {{ksCategoryRowData.name}}</h1>
    <h5>Category Info:</h5>
    <code>
      {{ ksCategoryRowData | pprint }}
    </code>
    <br><br>
    
    <h5>Child Categories</h5>
    <code>
      {% for child in ksChildTableData %}
      <div>
        {{child}}
      </div>
      
      {% endfor %}
    </code>
  </section> #}

{% endif %}


{# child category page - %parent%/%child% ------------------ #}
{% if ksSlugDepth == 2 %}
  {% set ksEncodedQueryVal = ksCategoryRowData.name | trim | urlencode %}
  {% set ksProductsFilterQuery = 'child_category__contains=' + ksEncodedQueryVal %}
  {% set ksProductData = hubdb_table_rows(ksProductsTableId, ksProductsFilterQuery) %}

  <section class="ks-heroimage">
    <figure class="ks-figure">
        <div class="ks-figure__liner">
            <img src="{{ksCategoryRowData.image.url}}" alt="">
        </div>
    </figure>
  </section>

  <section class="ks-productlist">
    <div class="ks-inner">

    {% for product in ksProductData %}
      <div class="ks-card ks-card--image">
        <a href="/products/{{product.hs_path}}" class="ks-linkover">
          <div class="ks-card__liner">
            <figure class="ks-figure">
              <div class="ks-figure__liner">
                <img src="{{product.featured_image}}" alt="">
              </div>
            </figure>
            <div class="ks-card__title">
              <p>{{product.product_title}}</p>
            </div>
          </div>
        </a>
      </div>
    {% endfor %}
    </div>
  </section>

  {# <section class="ks-section" style="background:#fff;padding:5rem 0;margin-top:5rem;">
    <div class="ks-inner">
      <h1>Child Category: {{dynamic_page_hubdb_row.name}}</h1>
      <h5>Category Info:</h5>
      <code>
        {{ ksCategoryRowData | pprint }}
      </code>
      <br><br>
      <h5>Matching Products:</h5>
      <code>
        {{ksProductData | pprint}}
      </code>
    </div>
  </section> #}

{% endif %}





{% include '/magnetic-creative/partials/footer-primary.html' %}